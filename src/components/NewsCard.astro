---
/**
 * NewsCard Component
 *
 * A reusable card component for displaying news posts in listing pages.
 * Displays publish date, category badge, title, description, and link to full post.
 *
 * Features:
 * - Category badges (releases, events, updates) using the Badge component
 * - Formatted publication date with Datetime component
 * - Hover effects with border and shadow transitions
 * - Responsive design
 * - Full accessibility support (ARIA labels, semantic HTML, keyboard navigation)
 * - Focus-within states for better keyboard accessibility
 *
 * @example
 * ```astro
 * <NewsCard
 *   id="cover-reveal-2025"
 *   data={{
 *     title: "Cover Reveal: The Neural Uprising",
 *     description: "See the stunning cover art for my upcoming sci-fi thriller!",
 *     publishDate: new Date('2025-01-15'),
 *     category: "releases"
 *   }}
 * />
 * ```
 */

import type { CollectionEntry } from "astro:content";
import { slugifyStr } from "@/utils/slugify";
import Datetime from "./Datetime.astro";
import Badge from "./Badge.astro";

export interface Props extends CollectionEntry<"news"> {
  variant?: "h2" | "h3";
}

const { variant = "h2", data, id } = Astro.props;

const { title, description, publishDate, category } = data;

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
  class:
    "text-xl font-bold decoration-dashed hover:underline focus-visible:underline",
};

// Map category to display labels
const categoryLabel = {
  releases: "Release",
  events: "Event",
  updates: "Update",
}[category];

const categoryBadgeVariant = `category-${category}` as const;

// Generate aria-label for better screen reader support
const ariaLabel = `${title}, ${categoryLabel} from ${publishDate.toLocaleDateString()}`;
---

<article
  class="group relative my-6 flex flex-col gap-4 rounded-lg border border-border p-4 transition-all hover:border-accent hover:shadow-md focus-within:border-accent focus-within:shadow-md"
>
  <div class="flex flex-col gap-3">
    <!-- Category Badge and Date -->
    <div class="flex flex-wrap items-center gap-3">
      <Badge
        variant={categoryBadgeVariant}
        text={categoryLabel}
        class="uppercase"
      />
      <Datetime
        pubDatetime={publishDate}
        modDatetime={null}
        timezone={undefined}
      />
    </div>

    <!-- Title Link -->
    <a
      href={`/news/${id}`}
      class="inline-block text-accent decoration-dashed underline-offset-4 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent focus-visible:no-underline focus-visible:underline-offset-0"
      aria-label={ariaLabel}
    >
      {
        variant === "h2" ? (
          <h2 {...headerProps}>{title}</h2>
        ) : (
          <h3 {...headerProps}>{title}</h3>
        )
      }
      <span class="sr-only">
        {categoryLabel} from {publishDate.toLocaleDateString()}
      </span>
    </a>

    <!-- Description -->
    <p class="text-foreground/80">{description}</p>
  </div>
</article>
