---
import type { CollectionEntry } from "astro:content";
import { slugifyStr } from "@/utils/slugify";
import Datetime from "./Datetime.astro";

export interface Props extends CollectionEntry<"news"> {
  variant?: "h2" | "h3";
}

const { variant = "h2", data, id } = Astro.props;

const { title, description, publishDate, category } = data;

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
  class: "text-lg font-semibold decoration-dashed hover:underline",
};

const categoryBadgeClass = {
  releases: "bg-purple-600 text-white",
  events: "bg-blue-600 text-white",
  updates: "bg-orange-600 text-white",
}[category];

const categoryLabel = {
  releases: "Release",
  events: "Event",
  updates: "Update",
}[category];
---

<article class="my-6 rounded-lg border border-border p-4 transition-all hover:border-accent hover:shadow-sm">
  <div class="mb-2 flex flex-wrap items-center gap-2">
    <span class={`rounded px-2 py-1 text-xs font-semibold uppercase ${categoryBadgeClass}`}>
      {categoryLabel}
    </span>
    <Datetime pubDatetime={publishDate} modDatetime={null} timezone={undefined} />
  </div>

  <a
    href={`/news/${id}`}
    class="inline-block text-accent decoration-dashed underline-offset-4 focus-visible:no-underline focus-visible:underline-offset-0"
  >
    {
      variant === "h2" ? (
        <h2 {...headerProps}>{title}</h2>
      ) : (
        <h3 {...headerProps}>{title}</h3>
      )
    }
  </a>

  <p class="mt-2 text-foreground/80">{description}</p>

  <div class="mt-3">
    <a
      href={`/news/${id}`}
      class="inline-flex items-center text-sm font-medium text-accent hover:underline"
    >
      Read More
      <svg class="ml-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"></path>
      </svg>
    </a>
  </div>
</article>
